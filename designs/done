#### RIBOSWITCH DESIGN

#python -u riboswitch_optimization.py > riboswitch.out

### manualy selected candidates based on score
echo AAGUGAUACCAGCAUCGUCUUGAUGCCCUUGGCAGCACUUCAACCCCAGCCACCUGAACAUGAGGUGUUGCUGGGGGCAUCUUUUUUUU | RNAsubopt -e 40 --noLP| python -u correct_subopt.py > riboswitch_01_0.01.sub
echo  AAGUGAUACCAGCAUCGUCUUGAUGCCCUUGGCAGCACUUCACCCCACGUGGGGUGUUGCCUUUUUUUU | RNAsubopt -e 30  --noLP| python -u correct_subopt.py > riboswitch_02_0.01.sub

echo AAGUGAUACCAGCAUCGUCUUGAUGCCCUUGGCAGCACUUCACUAGCAACAGCUAGUGAAGUGCUGCUAAGGGUGUUUUUUUUUU | RNAsubopt -e 50  --noLP| python -u correct_subopt.py > riboswitch_03_2.89.sub
echo AAGUGAUACCAGCAUCGUCUUGAUGCCCUUGGCAGCACUUCACAGCACUGGGGUGCUGUUGGGGGUGUUUUUUUU | RNAsubopt -e 35  --noLP| python -u correct_subopt.py > riboswitch_04_2.52.sub

### sort
for I in *.sub; do sort -T sort_tmp/ -k2n < $I > $I.sorted; done
### do barrier

for I in *.sorted; do ~/bin/PROGS/Barriers-1.5.2/barriers -G RNA-noLP --bsize --rates < $I > $I.bar; done

~/bin/PROGS/Treekin-0.3.1/treekin -m I --p0 1=1 < $I.bar | xmgrace -log x -nxy -


#### COFOLD DESIGN

python -u sven_cofold_design.py -p > srna-5prime-cofold.out


# drawing done
GGGAAGCACCAGUCGGUUUAUCACAAGCCGCUGGUGCUUAGAGUAAAGAUAAGGAGUAAUGAAAUG&GGGUCCUAGCGUCAUUCACGCGGACCCUUCAUUUCAUUACUCCUUAUCUUUAUUCACCUAGCAUAACCCCUUGGGGCCUCUAAACGGGUCUUGAGGGGUUUUUUG	  1.08


#### BOOKCHAPTER
#two_state.out: (design.pf_energy[0]-design.pf_energy[2]) + (design.pf_energy[1]-design.pf_energy[3]); -n 5 -r 10,10

#three_state.out: (design.pf_energy[0]-design.pf_energy[2]) + (design.pf_energy[1]-design.pf_energy[3]) + (design.pf_energy[4]-design.pf_energy[3]); -n 5 -r 10,10

#prob_state.out: (1-Z_from_G((design.pf_energy[0]-design.pf_energy[3]))) #(A|+) + abs(Z_from_G((design.pf_energy[1]-design.pf_energy[4]))-0.9) #(0|-) + abs(Z_from_G((design.pf_energy[5]-design.pf_energy[4]))-0.1) #(A|-); -n 10 -r 1,1

#python -u bookchapter_switch_optimization.py -r 1,1 -n 10 > prob_state.out

grep -P "^AA" prob_state.out | head -n 10 | perl -ane 'BEGIN{$i=0;}{use RNA; if($F[0]!~/^[ACGTU]+$/){print STDERR "could not use input ",$_; exit;} print $F[0],"\n"; ($str,$e)=RNA::fold($F[0]); $bef = "echo ".$F[0]." | RNAsubopt -e ".($e*-1)." | sort -k 2n > ".$i.".ssub; python correct_subopt.py -f ".$i.".ssub | sort -k 2n > ".$i.".scsub"; $i++; system($bef);}'

for I in *.scsub; do ~/bin/PROGS/Barriers-1.5.2/barriers --max=500 -G RNA-noLP -M noShift --bsize --rates < $I > $I.bar; mv tree.ps $I.tree.ps;mv rates.bin $I.rates.bin; mv rates.out $I.rates.out; done
for I in *.ssub; do ~/bin/PROGS/Barriers-1.5.2/barriers --max=500 -G RNA-noLP -M noShift --bsize --rates < $I > $I.bar; mv tree.ps $I.tree.ps; mv rates.bin $I.rates.bin; mv rates.out $I.rates.out; done

for I in {0..9}; do ~/bin/PROGS/Treekin-0.3.1/treekin -m I --p0 1=1 -f $I.ssub.rates.out < $I.ssub.bar > $I.ssub.kin; done

export lauf=0; tail -n 2 $lauf.ssub.kin | head -n 1 | perl -ane 'BEGIN{$bef="~/bin/PROGS/Treekin-0.3.1/treekin";}{for($i=1; $i<(scalar(@F)-1); $i++){$bef .= " --p0 ".$i."=".$F[$i];}}END{$bef.= " -m I -f ".$ENV{'lauf'}.".ssub.rates.out -a 9 < ".$ENV{'lauf'}.".ssub.bar > ".$ENV{'lauf'}.".ssub.kin2"; print($bef);}'

export lauf=1; tail -n 2 $lauf.ssub.kin | head -n 1 | perl -ane 'BEGIN{$bef="~/bin/PROGS/Treekin-0.3.1/treekin";}{for($i=1; $i<(scalar(@F)-1); $i++){$bef .= " --p0 ".$i."=".$F[$i];}}END{$bef.= " -m I -f ".$ENV{'lauf'}.".ssub.rates.out -a 47 < ".$ENV{'lauf'}.".ssub.bar > ".$ENV{'lauf'}.".ssub.kin2"; system($bef);}'

export lauf=2; tail -n 2 $lauf.ssub.kin | head -n 1 | perl -ane 'BEGIN{$bef="~/bin/PROGS/Treekin-0.3.1/treekin";}{for($i=1; $i<(scalar(@F)-1); $i++){$bef .= " --p0 ".$i."=".$F[$i];}}END{$bef.= " -m I -f ".$ENV{'lauf'}.".ssub.rates.out --t8 1e+11 -a 110 < ".$ENV{'lauf'}.".ssub.bar > ".$ENV{'lauf'}.".ssub.kin2"; system($bef);}'

export lauf=3; tail -n 2 $lauf.ssub.kin | head -n 1 | perl -ane 'BEGIN{$bef="~/bin/PROGS/Treekin-0.3.1/treekin";}{for($i=1; $i<(scalar(@F)-1); $i++){$bef .= " --p0 ".$i."=".$F[$i];}}END{$bef.= " -m I -f ".$ENV{'lauf'}.".ssub.rates.out -a 21 < ".$ENV{'lauf'}.".ssub.bar > ".$ENV{'lauf'}.".ssub.kin2"; system($bef);}'

export lauf=4; tail -n 2 $lauf.ssub.kin | head -n 1 | perl -ane 'BEGIN{$bef="~/bin/PROGS/Treekin-0.3.1/treekin";}{for($i=1; $i<(scalar(@F)-1); $i++){$bef .= " --p0 ".$i."=".$F[$i];}}END{$bef.= " -m I -f ".$ENV{'lauf'}.".ssub.rates.out -a 45 < ".$ENV{'lauf'}.".ssub.bar > ".$ENV{'lauf'}.".ssub.kin2"; system($bef);}'

export lauf=5; tail -n 2 $lauf.ssub.kin | head -n 1 | perl -ane 'BEGIN{$bef="~/bin/PROGS/Treekin-0.3.1/treekin";}{for($i=1; $i<(scalar(@F)-1); $i++){$bef .= " --p0 ".$i."=".$F[$i];}}END{$bef.= " -m I -f ".$ENV{'lauf'}.".ssub.rates.out -a 26 < ".$ENV{'lauf'}.".ssub.bar > ".$ENV{'lauf'}.".ssub.kin2"; system($bef);}'

export lauf=6; tail -n 2 $lauf.ssub.kin | head -n 1 | perl -ane 'BEGIN{$bef="~/bin/PROGS/Treekin-0.3.1/treekin";}{for($i=1; $i<(scalar(@F)-1); $i++){$bef .= " --p0 ".$i."=".$F[$i];}}END{$bef.= " -m I -f ".$ENV{'lauf'}.".ssub.rates.out -t8 1e+11 -a 19 < ".$ENV{'lauf'}.".ssub.bar > ".$ENV{'lauf'}.".ssub.kin2"; system($bef);}'

export lauf=7; tail -n 2 $lauf.ssub.kin | head -n 1 | perl -ane 'BEGIN{$bef="~/bin/PROGS/Treekin-0.3.1/treekin";}{for($i=1; $i<(scalar(@F)-1); $i++){$bef .= " --p0 ".$i."=".$F[$i];}}END{$bef.= " -m I -f ".$ENV{'lauf'}.".ssub.rates.out -a 12 < ".$ENV{'lauf'}.".ssub.bar > ".$ENV{'lauf'}.".ssub.kin2"; system($bef);}'

export lauf=8; tail -n 2 $lauf.ssub.kin | head -n 1 | perl -ane 'BEGIN{$bef="~/bin/PROGS/Treekin-0.3.1/treekin";}{for($i=1; $i<(scalar(@F)-1); $i++){$bef .= " --p0 ".$i."=".$F[$i];}}END{$bef.= " -m I -f ".$ENV{'lauf'}.".ssub.rates.out -a 16 < ".$ENV{'lauf'}.".ssub.bar > ".$ENV{'lauf'}.".ssub.kin2"; system($bef);}'

export lauf=9; tail -n 2 $lauf.ssub.kin | head -n 1 | perl -ane 'BEGIN{$bef="~/bin/PROGS/Treekin-0.3.1/treekin";}{for($i=1; $i<(scalar(@F)-1); $i++){$bef .= " --p0 ".$i."=".$F[$i];}}END{$bef.= " -m I -f ".$ENV{'lauf'}.".ssub.rates.out -a 61 < ".$ENV{'lauf'}.".ssub.bar > ".$ENV{'lauf'}.".ssub.kin2"; system($bef);}'



perl coarsify.pl -minh 30 -conv 0.000005 0.ssub.bar 0.ssub.kin
perl coarsify.pl -minh 30 -conv 0.000005 0.ssub.bar 0.ssub.kin2

xmgrace -log x -nxy 0.ssub.kin_30.tkin


### KINFOLD
### didn't do it!!!

#cleanup
for I in ~/TMP/parallel_kinfold*; do rm $I; done
for I in {1..10}; do for J in kinfold_output$I/*.txt; do rm $J; done; for J in kinfold_output$I/*.log; do rm $J; done;done

# run parallel kinfolds
qsub sge_script.sh

# collect data
for I in {1..10}; do rm kinfold_complete_$I.out; for J in kinfold_output$I/*.txt; do cat $J >> kinfold_complete_$I.out; done; done

for I in kinfold_complete_*.out; do echo $I; awk '{print $3}' $I | ~/bin/OWN/column2stat.pl; done > stat_rev.out




   1 ...........((.((((.......(((((((((((......)))))))))))....)))))). -19.40    0  14.66       182972        0 -19.829251     7325 -19.597067
   8 (((((...((((((((.....)))))...)))...)))))..(((..(((.....)))..))). -16.50    1   7.00         2319     6394 -17.731103     1798 -17.206544

  18 (((((...((((((((.....)))))...)))...)))))..(((....((....))...))). -15.30    8   3.10          104      127 -16.621036     1214 -16.108962
  19 (((((...((((((((.....)))))...)))...)))))......(((.((...)).)))... -15.30    8   3.40           83      285 -16.776932     2208 -16.620381
  23 (((((...((((((((.....)))))...)))...)))))...((((.((.....))))))... -15.10    8   1.60           12       34 -15.902022     1577 -15.933599
  24 (((((...((((((((.....)))))...)))...)))))...(((.(((.....))))))... -15.10    8   1.10            4       19 -15.690554      644 -15.838371
  26 (((((...((((((((.....)))))...)))...)))))..(((((.((.....)))).))). -15.00    8   0.10            1        5 -15.000000      567 -15.671024
  32 (((((...((((((((.....)))))...)))...)))))....(((((.((...)).)).))) -14.70   19   0.50            4       12 -15.344152      719 -15.644580
  37 (((((...((((((((.....)))))...)))...)))))......(((((....)).)))... -14.60   18   1.20           23       13 -16.003931     1351 -15.924097
  41 (((((...((((((((.....)))))...)))...)))))..(((..((.((...)).))))). -14.50   19   0.50            3       20 -14.994077      557 -15.173983
  43 (((((...((((((((.....)))))...)))...)))))...((((..((....))))))... -14.30   18   1.50           10       70 -15.071872      535 -15.081583
  46 (((((...((((((((.....)))))...)))...)))))..(((((.((.....))))).)). -14.20   23   0.20            1        4 -14.200000      336 -14.854749
  47 (((((...((((((((.....)))))...)))...)))))..((((.(((.....))))).)). -14.20    8   0.20            1       17 -14.200000      250 -14.841635
  52 (((((...((((((((.....)))))...)))...)))))....(((((((....)).)).))) -14.00   37   0.50            4       12 -14.644152      754 -15.163387
  53 (((((...((((((((.....)))))...)))...)))))....((((.((....))...)))) -14.00   37   0.50            4       18 -14.644152      572 -14.956834
  55 (((((...((((((((.....)))))...)))...)))))..((.(((.....))).))..... -13.80    8   4.10           55     1879 -14.758776      480 -14.487282
  57 (((((...((((((((.....)))))...)))...))))).........((....))....... -13.70   37   0.20            1       12 -13.700000     1599 -14.626643
  77 (((((...((((((((.....)))))...)))...)))))....((((((.....)))...))) -13.50    8   0.30            1       61 -13.500000      265 -14.179479
  78 (((((...((((((((.....)))))...)))...)))))..(((((..((....))))).)). -13.40   43   0.20            1        4 -13.400000      265 -14.093175
  85 (((((...((((((((.....)))))...)))...)))))....((((((.....))...)))) -13.20    8   1.30            8      285 -14.085831      265 -14.136337
  87 (((((...((((((((.....)))))...)))...)))))....((((..((...))...)))) -13.10   19   1.10            8       74 -13.985831      268 -14.036751
 121 (((((...((((((((.....)))))...)))...)))))..............((.....)). -12.40    8   0.20            1      127 -12.400000      474 -13.140657

 127 (((((...((((((((.....)))))...)))...)))))..(((........)))........ -12.30    1   2.90           16     9869 -13.069398      250 -13.070842

 143 (((((...((((((((.....)))))...)))...)))))...((((...((...))))))... -11.90    8   0.60            3      573 -12.394077      162 -12.644314
 168 (((((...((((((((.....)))))...)))...)))))..((((((.....)))....))). -11.60   55   1.60            4       43 -12.190554      110 -12.258725

