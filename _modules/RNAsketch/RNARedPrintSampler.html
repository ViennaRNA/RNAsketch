<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>RNAsketch.RNARedPrintSampler &#8212; RNAsketch 1.5.0 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/rnasketch.png"></span>
          RNAsketch</a>
        <span class="navbar-text navbar-version pull-left"><b>1.5</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../module.html">Module content</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../classes.html">Classes</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary">
<form action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-9 content">
      
  <h1>Source code for RNAsketch.RNARedPrintSampler</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    RNARedPrintSampler.py: Class that uses system calls to sample sequences with the RNARedPrint program. It implements the same interface as the DependencyGraph of RNAblueprint. This makes it possible to use it within RNAsketch to optimize sequences.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Stefan Hammer&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright 2017&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.1&quot;</span>
<span class="n">__maintainer__</span> <span class="o">=</span> <span class="s2">&quot;Stefan Hammer&quot;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s2">&quot;s.hammer@univie.ac.at&quot;</span>

<span class="kn">from</span> <span class="nn">distutils.dir_util</span> <span class="k">import</span> <span class="n">copy_tree</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">timeit</span>
<span class="kn">import</span> <span class="nn">subprocess</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">RNAsketch</span> <span class="k">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>

<span class="kn">from</span> <span class="nn">Structure</span> <span class="k">import</span> <span class="n">RNAStructure</span>

<div class="viewcode-block" id="RPSampler"><a class="viewcode-back" href="../../classes.html#RNAsketch.RNARedPrintSampler.RPSampler">[docs]</a><span class="k">class</span> <span class="nc">RPSampler</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    RPSampler is a python wrapper for RNARedPrint and implements a similar interface to the RNAblueprint DependencyGraphMT object.</span>

<span class="sd">    :param structures: List of Dot-bracket structure strings</span>
<span class="sd">    :param constraint: Sequence constraints in IUPACK notation</span>
<span class="sd">    :param model: String specifying the model, can be &#39;uniform&#39;,  &#39;nussinov&#39;, &#39;basepairs&#39; or &#39;stacking&#39;</span>
<span class="sd">    :param weights: List of integers specifying the boltzmann weight for the target structures, range in ]0, +infinity]</span>
<span class="sd">    :param gcweight: Integer specifying the GC-weight, ]0, +infinity]</span>
<span class="sd">    :param temperature: Temperature for the folding predictions (default: 37.0 degree celsius)</span>
<span class="sd">    :param stacksize: Size of one sequence sampling batch (default: 1000 sequences)</span>
<span class="sd">    :param StopConstruct: Bool specifying if we want to benchmark the construction time. Measured time can be obtained from construction_time after construction (default: False)</span>
<span class="sd">    :param RedPrintFolder: Location of the RNARedPrint project folder (default: &#39;./RNARedPrint/&#39;)</span>
<span class="sd">    :param debug: Bool to print debug statements (default: False)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structures</span><span class="p">,</span> <span class="n">constraint</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;nussinov&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="p">[],</span> <span class="n">gcweight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">37.0</span><span class="p">,</span> <span class="n">stacksize</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">StopConstruct</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">RedPrintFolder</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_structures</span> <span class="o">=</span> <span class="n">structures</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constraint</span> <span class="o">=</span> <span class="n">constraint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_samplestack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stacksize</span> <span class="o">=</span> <span class="n">stacksize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">construction_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_connected_components</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gcweight</span> <span class="o">=</span> <span class="n">gcweight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_temperature</span> <span class="o">=</span> <span class="n">temperature</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span> <span class="o">=</span> <span class="n">debug</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">RedPrintFolder</span><span class="p">:</span>
            <span class="n">RedPrintFolder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">RedPrintFolder</span><span class="p">:</span>
                <span class="n">RedPrintFolder</span> <span class="o">=</span> <span class="s1">&#39;./RNARedPrint/&#39;</span>
        <span class="c1"># copy RNARedprint binary to temp toDirectory for multithread</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_RNAredprint_folder</span><span class="p">(</span><span class="n">RedPrintFolder</span><span class="p">)</span>

        <span class="c1"># call RNAredprint to get construction time</span>
        <span class="k">if</span> <span class="n">StopConstruct</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_call_RNAredprint</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_RedPrintFolder</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subfolder</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Try to detect the RNARedPrint project folder location</span>

<span class="sd">        :param subfolder: string specifying a subfolder, e.g. &#39;bin/&#39;</span>
<span class="sd">        :return: string with the complete project path</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;REDPRINT&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;REDPRINT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">subfolder</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">subfolder</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        String specifying the sampling model.</span>

<span class="sd">        :return: string, can be &#39;uniform&#39;,  &#39;nussinov&#39;, &#39;basepairs&#39; or &#39;stacking&#39;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span>
    <span class="nd">@model</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">modelarg</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;uniform&#39;</span><span class="p">:</span>
            <span class="n">modelarg</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;nussinov&#39;</span><span class="p">:</span>
            <span class="n">modelarg</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;basepairs&#39;</span><span class="p">:</span>
            <span class="n">modelarg</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;stacking&#39;</span><span class="p">:</span>
            <span class="n">modelarg</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Modelarg not set!&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_modelarg</span> <span class="o">=</span> <span class="n">modelarg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">weights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        List of integers specifying the boltzmann weight for the target structures, range in ]0, +infinity]</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span>
    <span class="nd">@weights</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">weights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># standard weights for boltzmann sampling</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_temperature</span> <span class="o">+</span> <span class="mf">273.15</span><span class="p">)</span><span class="o">*</span><span class="mf">0.00198717</span><span class="p">))]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_structures</span><span class="p">)</span>
        <span class="c1"># check amount of weights</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_structures</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Amount of weights must be equal to the amount of structures&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">w</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Weights must be in range ]0, +infinity]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gcweight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Integer specifying the GC-weight, ]0, +infinity]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gcweight</span>
    <span class="nd">@gcweight</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">gcweight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;GC weight must be in range ]0, +infinity]&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gcweight</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="RPSampler.dump_new_stack"><a class="viewcode-back" href="../../classes.html#RNAsketch.RNARedPrintSampler.RPSampler.dump_new_stack">[docs]</a>    <span class="k">def</span> <span class="nf">dump_new_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Draws a sample from RNARedPrint and returns the list of generated sequences at once. The variable stacksize specifies the amount of sequences.</span>

<span class="sd">        :return: List of RNA sequence strings</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_samplestack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">newseqs</span><span class="p">,</span> <span class="n">energies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_RNAredprint</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stacksize</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">newseqs</span><span class="p">,</span> <span class="n">energies</span></div>


<div class="viewcode-block" id="RPSampler.sample"><a class="viewcode-back" href="../../classes.html#RNAsketch.RNARedPrintSampler.RPSampler.sample">[docs]</a>    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Sample a new sequence.</span>

<span class="sd">        :return: Returns 0 for compatibility to DependencyGraphMT.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="RPSampler.sample_clocal"><a class="viewcode-back" href="../../classes.html#RNAsketch.RNARedPrintSampler.RPSampler.sample_clocal">[docs]</a>    <span class="k">def</span> <span class="nf">sample_clocal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Compatibility to the DependencyGraphMT object, calls sample() internally.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span></div>

<div class="viewcode-block" id="RPSampler.sample_plocal"><a class="viewcode-back" href="../../classes.html#RNAsketch.RNARedPrintSampler.RPSampler.sample_plocal">[docs]</a>    <span class="k">def</span> <span class="nf">sample_plocal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Compatibility to the DependencyGraphMT object, calls sample() internally.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span></div>

<div class="viewcode-block" id="RPSampler.get_sequence"><a class="viewcode-back" href="../../classes.html#RNAsketch.RNARedPrintSampler.RPSampler.get_sequence">[docs]</a>    <span class="k">def</span> <span class="nf">get_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the sampled sequence as a string.</span>

<span class="sd">        :return: RNA Sequence string in IUPACK notation</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_samplestack</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stacksize</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_stacksize</span> <span class="o">+=</span> <span class="mi">1000</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_new_sample</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_samplestack</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_current</span><span class="p">]</span></div>

<div class="viewcode-block" id="RPSampler.revert_sequence"><a class="viewcode-back" href="../../classes.html#RNAsketch.RNARedPrintSampler.RPSampler.revert_sequence">[docs]</a>    <span class="k">def</span> <span class="nf">revert_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Compatibility to the DependencyGraphMT object, does nothing internally.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#self._current -= amount</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="RPSampler.set_sequence"><a class="viewcode-back" href="../../classes.html#RNAsketch.RNARedPrintSampler.RPSampler.set_sequence">[docs]</a>    <span class="k">def</span> <span class="nf">set_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Compatibility to the DependencyGraphMT object, does nothing internally.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="RPSampler.set_history_size"><a class="viewcode-back" href="../../classes.html#RNAsketch.RNARedPrintSampler.RPSampler.set_history_size">[docs]</a>    <span class="k">def</span> <span class="nf">set_history_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Compatibility to the DependencyGraphMT object, does nothing internally.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">pass</span></div>
        <span class="c1">#if self._stacksize != size:</span>
        <span class="c1">#    self._stacksize = size</span>
        <span class="c1">#    self._get_new_sample()</span>

    <span class="k">def</span> <span class="nf">_get_new_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># generate list of sequences with RNAredprint</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_debug</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;# getting new sequences: &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stacksize</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_samplestack</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stacksize</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_samplestack</span><span class="p">)))</span>
        <span class="n">newseqs</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_RNAredprint</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stacksize</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_samplestack</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_samplestack</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">newseqs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_copy_RNAredprint_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RedPrintFolder</span><span class="p">):</span>
        <span class="c1"># copy subdirectory example</span>
        <span class="n">fromDirectory</span> <span class="o">=</span> <span class="n">RedPrintFolder</span>
        <span class="n">toDirectory</span> <span class="o">=</span> <span class="s2">&quot;/tmp/RNARedPrint-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_RedPrintFolder</span> <span class="o">=</span> <span class="n">toDirectory</span>
        <span class="n">copy_tree</span><span class="p">(</span><span class="n">fromDirectory</span><span class="p">,</span> <span class="n">toDirectory</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_call_RNAredprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="c1"># resolve PKs</span>
        <span class="n">structuresNoPK</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_structures</span><span class="p">):</span>
            <span class="n">structuresNoPK</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">RNAStructure</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">resolvePKs</span><span class="p">()</span>
            <span class="n">weights</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># create structure and weight list</span>
        <span class="n">structures_cmd</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">weights_cmd</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">struct</span><span class="p">,</span> <span class="n">NoPKs</span> <span class="ow">in</span> <span class="n">structuresNoPK</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">NoPK</span> <span class="ow">in</span> <span class="n">NoPKs</span><span class="p">:</span>
                <span class="n">structures_cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">NoPK</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
                <span class="n">weights_cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">struct</span><span class="p">])</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;./RNARedPrint&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">structures_cmd</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;--num&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">),</span> <span class="s1">&#39;--model&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_modelarg</span><span class="p">),</span> <span class="s1">&#39;-gcw&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gcweight</span><span class="p">),</span> <span class="s1">&#39;--weights&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">weights_cmd</span><span class="p">))]</span>
        <span class="c1">#cmd=[&#39;ls&#39;]</span>
        <span class="n">cmdstring</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_debug</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# &quot;</span><span class="p">,</span> <span class="n">cmdstring</span><span class="p">)</span>
        <span class="c1">#cmd = [&#39;RNAblueprint&#39;, &#39;-n&#39;, str(number)]</span>
        <span class="c1">#stdin = &#39;\n&#39;.join(structures+[constraint])</span>
        <span class="c1">#p = sp.Popen(cmd, stdin=sp.PIPE, stdout=sp.PIPE, stderr=sp.PIPE)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmdstring</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">sp</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">sp</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">sp</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_RedPrintFolder</span> <span class="o">+</span> <span class="s2">&quot;/bin/&quot;</span><span class="p">)</span>
        <span class="c1">#out, err = p.communicate(input=stdin)</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">exit</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">construction_time</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sample_time</span> <span class="o">+=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_debug</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# &quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="n">seqpattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[AUGC]+&quot;</span><span class="p">)</span>
        <span class="n">strucpattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[\.\(\)]+$&quot;</span><span class="p">)</span>
        <span class="n">epattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;E(\d)=(-?[\d]+\.?[\d]*)&quot;</span><span class="p">)</span>

        <span class="n">structures</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sequences</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">energies</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">strucpattern</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">s</span><span class="p">:</span>
                <span class="n">structures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">seqpattern</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">s</span><span class="p">:</span>
                    <span class="n">sequences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                    <span class="n">struct_energy</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">epattern</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
                        <span class="n">struct_energy</span><span class="p">[</span><span class="n">structures</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
                    <span class="n">energy</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_structures</span><span class="p">):</span>
                        <span class="n">energy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">for</span> <span class="n">sNoPKs</span> <span class="ow">in</span> <span class="n">structuresNoPK</span><span class="p">[</span><span class="n">s</span><span class="p">]:</span>
                            <span class="n">energy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">struct_energy</span><span class="p">[</span><span class="n">sNoPKs</span><span class="p">]</span>
                    <span class="n">energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sequences</span><span class="p">,</span> <span class="n">energies</span></div>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2018, Stefan Hammer.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.8.<br/>
    </p>
  </div>
</footer>
  </body>
</html>